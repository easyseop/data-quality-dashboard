{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">ğŸ‘¨â€ğŸ’¼ ì •ê¸° ê²€ì¦ â€” ì˜¤ë¥˜ ë‹´ë‹¹ì í˜„í™©</h2>

<form method="get" action="/owner/regular" class="row mb-3">

    <!-- ë…„ë„ -->
    <div class="col-md-3">
        <label><b>ë…„ë„</b></label>
        <select name="year" class="form-select" onchange="this.form.submit()">
            {% for y in year_list %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>
                {{ y }}ë…„
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- ê²€ì¦ ì°¨ìˆ˜ -->
    <div class="col-md-3">
        <label><b>ê²€ì¦ ì°¨ìˆ˜</b></label>
        <select name="cycle" class="form-select" onchange="this.form.submit()">
            {% for c in cycle_list %}
            <option value="{{ c }}" {% if c == selected_cycle %}selected{% endif %}>
                {{ c }}
            </option>
            {% endfor %}
        </select>
    </div>

    <!-- AppCode -->
    <div class="col-md-3">
        <label><b>AppCode</b></label>
        <select name="app" class="form-select" onchange="this.form.submit()">
            <option value="ALL" {% if selected_app == "ALL" %}selected{% endif %}>ALL</option>
            {% for app in app_list %}
            <option value="{{ app }}" {% if selected_app == app %}selected{% endif %}>
                {{ app }}
            </option>
            {% endfor %}
        </select>
    </div>

</form>

<hr>

<!-- ì„ íƒëœ ì •ê¸° ê¸°ì¤€ë…„ì›”ì¼ í‘œì‹œ -->
<p class="text-muted">
    ì„ íƒëœ ê¸°ì¤€ì¼(ì •ê¸°): <b>{{ selected_base }}</b>
</p>

<table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>No</th>
            <th>App</th>
            <th>ì˜¤ë¥˜ì»¬ëŸ¼ìˆ˜</th>
            <th>ë‹´ë‹¹ìëª…</th>
            <th>User ID</th>
            <th>ì¡°ì§ëª…</th>
            <th>ì í¬ëª…</th>
        </tr>
    </thead>
    <tbody>
    {% for r in rows %}
        <tr>
            <td>{{ r.rownum }}</td>
            <td>{{ r.app_code }}</td>
            <td class="text-danger fw-bold">{{ r.error_cols }}</td>
            <td>{{ r.user_nm or "-" }}</td>
            <td>{{ r.user_id or "-" }}</td>
            <td>{{ r.org_nm or "-" }}</td>
            <td>{{ r.brn_nm or "-" }}</td>
        </tr>
    {% endfor %}
    {% if rows|length == 0 %}
        <tr>
            <td colspan="7" class="text-muted text-center">
                í•´ë‹¹ ì¡°ê±´ì— ëŒ€í•œ ì •ê¸° ê²€ì¦ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.
            </td>
        </tr>
    {% endif %}
    </tbody>
</table>

<!-- pagination -->
<nav>
    <ul class="pagination justify-content-center">
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link"
               href="?page={{ p }}&year={{ selected_year }}&cycle={{ selected_cycle }}&app={{ selected_app }}">
               {{ p }}
            </a>
        </li>
        {% endfor %}
    </ul>
</nav>

{% endblock %}
