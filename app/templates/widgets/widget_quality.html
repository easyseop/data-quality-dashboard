<div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-bold mb-0">ğŸ” í’ˆì§ˆ ì ê²€ ê²°ê³¼ ìš”ì•½</h4>

    <!-- Premium Segmented Control Toggle -->
    <div class="btn-group btn-group-sm" role="group" aria-label="Display Mode">
        <input type="radio" class="btn-check" name="kpiToggle" id="btnKpiPercent" autocomplete="off" checked
            onclick="toggleKpiDisplay('percent')">
        <label class="btn btn-outline-primary" for="btnKpiPercent">%</label>

        <input type="radio" class="btn-check" name="kpiToggle" id="btnKpiFraction" autocomplete="off"
            onclick="toggleKpiDisplay('fraction')">
        <label class="btn btn-outline-primary" for="btnKpiFraction">ê±´ìˆ˜</label>
    </div>
</div>

<table class="table table-bordered table-sm text-center align-middle">
    <thead class="table-light">
        <tr>
            <th></th>
            <th>ê²€ì¦ì»¬ëŸ¼</th>
            <th>ì˜¤ë¥˜ì»¬ëŸ¼</th>
            <th id="kpiHeader">í’ˆì§ˆì§€ìˆ˜(%)</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><b>ì „ì²´</b></td>
            <td>{{ kpi_all.verified }}</td>
            <td class="text-danger">{{ kpi_all.error }}</td>
            <td class="quality-cell warning-text fw-bold" data-verified="{{ kpi_all.verified }}"
                data-error="{{ kpi_all.error }}" data-quality="{{ kpi_all.quality }}">
                {{ kpi_all.quality }}%
            </td>
        </tr>
        <tr>
            <td>ì¸ìŠ¤í„´ìŠ¤(I)</td>
            <td>{{ kpi_inst.verified }}</td>
            <td class="text-danger">{{ kpi_inst.error }}</td>
            <td class="quality-cell" data-verified="{{ kpi_inst.verified }}" data-error="{{ kpi_inst.error }}"
                data-quality="{{ kpi_inst.quality }}">
                {{ kpi_inst.quality }}%
            </td>
        </tr>
        <tr>
            <td>ë‚ ì§œ(D)</td>
            <td>{{ kpi_date.verified }}</td>
            <td class="text-danger">{{ kpi_date.error }}</td>
            <td class="quality-cell" data-verified="{{ kpi_date.verified }}" data-error="{{ kpi_date.error }}"
                data-quality="{{ kpi_date.quality }}">
                {{ kpi_date.quality }}%
            </td>
        </tr>
        <tr>
            <td>ëª©ë¡(L)</td>
            <td>{{ kpi_list.verified }}</td>
            <td class="text-danger">{{ kpi_list.error }}</td>
            <td class="quality-cell" data-verified="{{ kpi_list.verified }}" data-error="{{ kpi_list.error }}"
                data-quality="{{ kpi_list.quality }}">
                {{ kpi_list.quality }}%
            </td>
        </tr>
    </tbody>
</table>

<script>
    // No global default strictly needed if we pass mode relative to radio button, 
    // but keeping it consistent with other widget.

    function toggleKpiDisplay(mode) {
        const cells = document.querySelectorAll('.quality-cell');
        const header = document.getElementById('kpiHeader');

        if (mode === 'fraction') {
            // Switch to Fraction
            header.innerText = "í’ˆì§ˆì§€ìˆ˜ (ì •ìƒ/ì „ì²´)";
            cells.forEach(cell => {
                const v = parseInt(cell.getAttribute('data-verified')) || 0;
                const e = parseInt(cell.getAttribute('data-error')) || 0;
                const pass = v - e;
                cell.innerText = `${pass} / ${v}`;
            });
        } else {
            // Switch to Percent
            header.innerText = "í’ˆì§ˆì§€ìˆ˜(%)";
            cells.forEach(cell => {
                const q = cell.getAttribute('data-quality');
                cell.innerText = `${q}%`;
            });
        }
    }
</script>