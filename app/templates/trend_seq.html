{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">ğŸ“ˆ ì—°ì† ì˜¤ë¥˜ ì—¬ë¶€ ë¶„ì„</h2>

<p class="text-muted small">
ìµœê·¼ ê¸°ì¤€ë…„ì›”ì¼ì— ì˜¤ë¥˜(Y) ë°œìƒí•œ ì»¬ëŸ¼ ëŒ€ìƒ / ì—°ì† ì˜¤ë¥˜ ì¶”ì 
</p>

<!-- Filters -->
<form method="get" action="/trend/seq" class="row mb-3">

    <div class="col-md-2">
        <label><b>ë…„ë„</b></label>
        <select name="year" class="form-select" onchange="this.form.submit()">
            {% for y in year_list %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}ë…„</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <label><b>ê²€ì¦êµ¬ë¶„</b></label>
        <select name="dtype" class="form-select" onchange="this.form.submit()">
            <option value="ì •ê¸°" selected>ì •ê¸°</option>
        </select>
    </div>


    <div class="col-md-2">
        <label><b>ì°¨ìˆ˜</b></label>
        <select name="cycle" class="form-select" onchange="this.form.submit()">
            {% for c in cycle_list %}
            <option value="{{ c }}" {% if c == selected_cycle %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-3">
        <label><b>AppCode í•„í„°</b></label>
        <select name="app" class="form-select" onchange="this.form.submit()">
            <option value="ALL" {% if selected_app == "ALL" %}selected{% endif %}>ALL</option>
            {% for app in app_list %}
            <option value="{{ app }}" {% if selected_app == app %}selected{% endif %}>{{ app }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-3">
        <label><b>ì˜¤ë¥˜ìœ í˜• í•„í„°</b></label>
        <select name="etype" class="form-select" onchange="this.form.submit()">
            <option value="ALL" {% if selected_etype == "ALL" %}selected{% endif %}>ALL</option>
            <option value="NEW" {% if selected_etype == "NEW" %}selected{% endif %}>ì‹ ê·œì˜¤ë¥˜</option>
            <option value="SEQ" {% if selected_etype == "SEQ" %}selected{% endif %}>ì—°ì†ì˜¤ë¥˜</option>
        </select>
    </div>

</form>


<table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>No</th>
            <th>App</th>
            <th>Table</th>
            <th>Column</th>
            <th>{{ d1 }}</th>
            <th>{{ d2 if d2 else "-" }}</th>
            <th>{{ d3 if d3 else "-" }}</th>
            <th>ì˜¤ë¥˜ìœ í˜•</th>
        </tr>
    </thead>
    <tbody>
    {% for r in rows %}
        <tr>
            <td>{{ loop.index + ((page-1) * per_page) }}</td>
            <td>{{ r.app_code }}</td>
            <td>{{ r.table_name }}</td>
            <td>{{ r.column_name }}</td>
            <td>{{ r.d1 or "-" }}</td>
            <td>{{ r.d2 or "-" }}</td>
            <td>{{ r.d3 or "-" }}</td>
            <td>
                {% if r.error_type == "ì‹ ê·œì˜¤ë¥˜" %}
                    <span class="badge bg-primary">ì‹ ê·œ</span>
                {% else %}
                    <span class="badge bg-danger">{{ r.seq }}ì—°ì†</span>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<nav>
    <ul class="pagination justify-content-center">
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link"
               href="?page={{ p }}&year={{ selected_year }}&dtype={{ selected_dtype }}&cycle={{ selected_cycle }}&app={{ selected_app }}&etype={{ selected_etype }}">
               {{ p }}
            </a>
        </li>
        {% endfor %}
    </ul>
</nav>

{% endblock %}
