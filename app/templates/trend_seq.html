{% extends "layout.html" %}
{% block content %}

<h2 class="mb-4">ğŸ“ˆ ì—°ì† ì˜¤ë¥˜ ì—¬ë¶€ ë¶„ì„</h2>

<p class="text-muted small">
ê°€ì¥ ìµœê·¼ ê¸°ì¤€ë…„ì›”ì¼ì— <b>ì˜¤ë¥˜(Y)</b>ì˜€ë˜ ì»¬ëŸ¼ë§Œ ëŒ€ìƒìœ¼ë¡œ ì—°ì† ì˜¤ë¥˜ ì—¬ë¶€ë¥¼ ë¶„ì„í•˜ì˜€ìŠµë‹ˆë‹¤.
</p>

<!-- Filters -->
<form method="get" action="/trend/seq" class="row mb-3">
    <div class="col-md-3">
        <label><b>ê¸°ì¤€ ê¸°ì¤€ë…„ì›”ì¼</b></label>
        <select name="base" class="form-select" onchange="this.form.submit()">
            {% for d in date_list %}
            <option value="{{ d }}" {% if d == selected_base %}selected{% endif %}>{{ d }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-3">
        <label><b>AppCode í•„í„°</b></label>
        <select name="app" class="form-select" onchange="this.form.submit()">
            <option value="ALL" {% if selected_app == "ALL" %}selected{% endif %}>ALL</option>
            {% for app in app_list %}
            <option value="{{ app }}" {% if selected_app == app %}selected{% endif %}>{{ app }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-3">
        <label><b>ì˜¤ë¥˜ìœ í˜• í•„í„°</b></label>
        <select name="etype" class="form-select" onchange="this.form.submit()">
            <option value="ALL" {% if selected_etype == "ALL" %}selected{% endif %}>ALL</option>
            <option value="NEW" {% if selected_etype == "NEW" %}selected{% endif %}>ì‹ ê·œì˜¤ë¥˜</option>
            <option value="SEQ" {% if selected_etype == "SEQ" %}selected{% endif %}>ì—°ì†ì˜¤ë¥˜</option>
        </select>
    </div>

</form>

<!-- Result Table -->
<table class="table table-bordered table-hover align-middle">
    <thead class="table-light">
        <tr>
            <th>No</th>
            <th>App</th>
            <th>Table</th>
            <th>Column</th>
            <th>{{ d1 }}</th>
            <th>{{ d2 if d2 else "-" }}</th>
            <th>{{ d3 if d3 else "-" }}</th>
            <th>ì—°ì†ì˜¤ë¥˜ì—¬ë¶€</th>
        </tr>
    </thead>
    <tbody>
    {% for r in rows %}
        <tr>
            <td>{{ loop.index + ((page-1) * per_page) }}</td>
            <td>{{ r.app_code }}</td>
            <td>{{ r.table_name }}</td>
            <td>{{ r.column_name }}</td>
            <td>{{ r.d1 or "-" }}</td>
            <td>{{ r.d2 or "-" }}</td>
            <td>{{ r.d3 or "-" }}</td>
            <td>
                {% if r.error_type == "ì‹ ê·œì˜¤ë¥˜" %}
                    <span class="badge bg-primary">ì‹ ê·œ</span>
                {% else %}
                    <span class="badge bg-danger">{{ r.seq }}ì—°ì†</span>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<!-- Pagination -->
<nav>
    <ul class="pagination justify-content-center">
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link"
                href="?page={{ p }}&base={{ selected_base }}&app={{ selected_app }}&etype={{ selected_etype }}">
                {{ p }}
            </a>
        </li>
        {% endfor %}
    </ul>
</nav>

{% endblock %}