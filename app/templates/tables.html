{% extends "layout.html" %}
{% block content %}

<h2>ğŸ“‚ Table List</h2>
<p>í…Œì´ë¸” ê²€ìƒ‰ / í˜ì´ì§• / ì •ë ¬ / í´ë¦­ ìƒì„¸ ì´ë™</p>

<!-- Filters -->
<div class="row mb-3">
    <div class="col-md-2">
        <label><b>ê¸°ì¤€ì¼ì</b></label>
        <select id="dateFilter" class="form-select">
            {% for d in date_list %}
            <option value="{{ d }}" {% if selected_date == d %}selected{% endif %}>{{ d }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <label><b>App Code</b></label>
        <select id="appFilter" class="form-select">
            <option value="">ALL</option>
            {% for app in app_code_list %}
            <option value="{{ app }}" {% if selected_app == app %}selected{% endif %}>{{ app }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<table id="tableList" class="table table-bordered table-hover">
    <thead class="table-light">
        <tr>
            <th>App Code</th>
            <th>Table Name</th>
            <th>Error Count</th>
            <th>Normal Count</th>
            <th>Error Rate</th>
        </tr>
    </thead>
    <tbody>
        {% for t in tables %}
        <tr>
            <td>{{ t["ì–´í”Œë¦¬ì¼€ì´ì…˜ì½”ë“œ"] }}</td>
            <td>{{ t["í…Œì´ë¸”ëª…"] }}</td>
            <td>{{ t["error_cnt"] }}</td>
            <td>{{ t["normal_cnt"] }}</td>
            <td>{{ t["error_rate"] }}%</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<script>
$(document).ready(function () {

    const table = $('#tableList').DataTable({
        pageLength: 50,
        ordering: true,
        searching: true,
        paging: true,
        lengthChange: false
    });

    // Filter change â†’ reload
    $('#dateFilter, #appFilter').on('change', function () {
        const date = $('#dateFilter').val();
        const app  = $('#appFilter').val();

        let newUrl = `/tables?date=${date}`;
        if (app) newUrl += `&app=${app}`;

        window.location.href = newUrl;
    });

    // Row click â†’ detail
    $('#tableList').on('click', 'tbody tr', function () {
        const tableName = $(this).find('td:eq(1)').text();
        const date = $('#dateFilter').val();
        window.location.href = `/detail/${tableName}?date=${date}`;
    });

});
</script>

{% endblock %}
